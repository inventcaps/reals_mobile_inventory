{% extends "base.html" %}
{% block title %}User Activity{% endblock %}

{% block content %}
<div class="container-fluid px-3 py-4">
  <!-- Header with Back Button -->
  <div class="d-flex align-items-center mb-4">
    <a href="{% url 'dashboard' %}" class="btn-back me-3">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M19 12H5M12 19l-7-7 7-7"/>
      </svg>
    </a>
    <h2 class="page-title mb-0">List of Users</h2>
  </div>

  <!-- Search Bar -->
  <div class="search-container mb-4">
    <input type="text" id="searchInput" class="search-input" placeholder="Search users...">
    <button class="search-clear" id="clearSearch" style="display: none;">×</button>
  </div>

  <!-- Filter Dropdown -->
  <div class="mb-3">
    <select id="statusFilter" class="filter-select">
      <option value="all">All</option>
      <option value="Active">Active</option>
      <option value="Logged Out">Logged Out</option>
      <option value="Inactive">Inactive</option>
    </select>
  </div>

  <!-- Users Table -->
  <div class="table-responsive">
    <table class="user-table">
      <thead>
        <tr>
          <th>Username</th>
          <th>Email</th>
          <th>Status</th>
          <th>Last Login</th>
          <th>Last Logout</th>
        </tr>
      </thead>
      <tbody id="userTableBody">
        {% for user in users %}
        <tr class="user-row" data-status="{{ user.status }}">
          <td data-label="Username">{{ user.username }}</td>
          <td data-label="Email">{{ user.email }}</td>
          <td data-label="Status">
            <span class="status-badge status-{{ user.status|lower|cut:' ' }}">
              {{ user.status }}
            </span>
          </td>
          <td data-label="Last Login">
            {% if user.last_login %}
              {{ user.last_login|date:"Y-m-d g:i A" }}
            {% else %}
              —
            {% endif %}
          </td>
          <td data-label="Last Logout">
            {% if user.last_logout %}
              {{ user.last_logout|date:"Y-m-d g:i A" }}
            {% else %}
              —
            {% endif %}
          </td>
        </tr>
        {% empty %}
        <tr>
          <td colspan="5" class="text-center py-4">No users found</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>

<style>
  /* Page Title */
  .page-title {
    color: #2f3e46;
    font-weight: 600;
    font-size: 1.5rem;
  }

  /* Back Button */
  .btn-back {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 40px;
    height: 40px;
    border-radius: 12px;
    background: rgba(255, 255, 255, 0.7);
    backdrop-filter: blur(10px);
    border: none;
    color: #2f3e46;
    transition: all 0.3s ease;
    text-decoration: none;
  }

  .btn-back:hover {
    background: rgba(255, 255, 255, 0.9);
    transform: scale(1.05);
  }

  /* Search Container */
  .search-container {
    position: relative;
    max-width: 600px;
  }

  .search-input {
    width: 100%;
    padding: 12px 40px 12px 16px;
    border-radius: 12px;
    border: none;
    background: rgba(255, 255, 255, 0.7);
    backdrop-filter: blur(10px);
    font-size: 1rem;
    transition: all 0.3s ease;
  }

  .search-input:focus {
    outline: none;
    background: rgba(255, 255, 255, 0.9);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
  }

  .search-clear {
    position: absolute;
    right: 12px;
    top: 50%;
    transform: translateY(-50%);
    background: rgba(0, 0, 0, 0.2);
    border: none;
    border-radius: 50%;
    width: 24px;
    height: 24px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    color: white;
    font-size: 18px;
    transition: all 0.3s ease;
  }

  .search-clear:hover {
    background: rgba(0, 0, 0, 0.4);
  }

  /* Filter Select */
  .filter-select {
    padding: 10px 16px;
    border-radius: 12px;
    border: none;
    background: rgba(255, 255, 255, 0.7);
    backdrop-filter: blur(10px);
    font-size: 0.95rem;
    cursor: pointer;
    transition: all 0.3s ease;
  }

  .filter-select:focus {
    outline: none;
    background: rgba(255, 255, 255, 0.9);
  }

  /* Table Styles */
  .table-responsive {
    background: rgba(255, 255, 255, 0.7);
    backdrop-filter: blur(15px);
    border-radius: 18px;
    padding: 1rem;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
  }

  .user-table {
    width: 100%;
    border-collapse: collapse;
  }

  .user-table thead {
    background: rgba(47, 62, 70, 0.1);
    border-radius: 12px;
  }

  .user-table th {
    padding: 14px 16px;
    text-align: left;
    font-weight: 600;
    color: #2f3e46;
    font-size: 0.9rem;
    border-bottom: 2px solid rgba(0, 0, 0, 0.1);
  }

  .user-table td {
    padding: 14px 16px;
    color: #555;
    font-size: 0.9rem;
    border-bottom: 1px solid rgba(0, 0, 0, 0.05);
  }

  .user-row {
    transition: all 0.3s ease;
  }

  .user-row:hover {
    background: rgba(119, 178, 84, 0.1);
  }

  /* Status Badges */
  .status-badge {
    display: inline-block;
    padding: 6px 14px;
    border-radius: 20px;
    font-size: 0.85rem;
    font-weight: 500;
    text-align: center;
  }

  .status-active {
    background: #d4edda;
    color: #155724;
  }

  .status-loggedout {
    background: #d1d3d4;
    color: #383d41;
  }

  .status-inactive {
    background: #f8d7da;
    color: #721c24;
  }

  /* Mobile Responsive Styles */
  @media (max-width: 768px) {
    .page-title {
      font-size: 1.25rem;
    }

    .user-table thead {
      display: none;
    }

    .user-table, 
    .user-table tbody, 
    .user-table tr, 
    .user-table td {
      display: block;
      width: 100%;
    }

    .user-row {
      margin-bottom: 1rem;
      background: rgba(255, 255, 255, 0.5);
      border-radius: 12px;
      padding: 12px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
    }

    .user-row:hover {
      background: rgba(255, 255, 255, 0.7);
    }

    .user-table td {
      padding: 8px 0;
      border: none;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .user-table td:before {
      content: attr(data-label);
      font-weight: 600;
      color: #2f3e46;
      margin-right: 10px;
    }

    .user-table td:last-child {
      border-bottom: none;
    }

    .status-badge {
      margin-left: auto;
    }
  }

  @media (max-width: 576px) {
    .container-fluid {
      padding-left: 1rem !important;
      padding-right: 1rem !important;
    }

    .page-title {
      font-size: 1.1rem;
    }

    .btn-back {
      width: 36px;
      height: 36px;
    }

    .search-input {
      font-size: 0.9rem;
      padding: 10px 36px 10px 14px;
    }

    .filter-select {
      font-size: 0.9rem;
      padding: 8px 14px;
    }

    .user-table td {
      font-size: 0.85rem;
    }

    .status-badge {
      font-size: 0.8rem;
      padding: 4px 10px;
    }
  }
</style>

<script>
  // Search functionality
  const searchInput = document.getElementById('searchInput');
  const clearSearch = document.getElementById('clearSearch');
  const statusFilter = document.getElementById('statusFilter');
  const tableBody = document.getElementById('userTableBody');
  const rows = tableBody.getElementsByClassName('user-row');

  searchInput.addEventListener('input', function() {
    const searchTerm = this.value.toLowerCase();
    clearSearch.style.display = searchTerm ? 'flex' : 'none';
    filterTable();
  });

  clearSearch.addEventListener('click', function() {
    searchInput.value = '';
    clearSearch.style.display = 'none';
    filterTable();
  });

  statusFilter.addEventListener('change', filterTable);

  function filterTable() {
    const searchTerm = searchInput.value.toLowerCase();
    const selectedStatus = statusFilter.value;

    Array.from(rows).forEach(row => {
      const username = row.cells[0].textContent.toLowerCase();
      const email = row.cells[1].textContent.toLowerCase();
      const status = row.getAttribute('data-status');

      const matchesSearch = username.includes(searchTerm) || email.includes(searchTerm);
      const matchesStatus = selectedStatus === 'all' || status === selectedStatus;

      row.style.display = matchesSearch && matchesStatus ? '' : 'none';
    });
  }
</script>
{% endblock %}
